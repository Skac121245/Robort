<!DOCTYPE html>
<html>

<head>
  <title>Robort</title>
  <script src="jquery-3.3.1.slim.min.js"></script>
  <link href="bootstrap.min.css" rel="stylesheet">
  <script src="showdown.min.js"></script>

  <style>
    #aboutTabsContent > .tab-pane {
      padding-top: 20px; /* Add space above the content in each tab */
    }

    body,
    nav,
    header,
    .navbar,
    #footer,
    a,
    #backgroundImage {
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body {
      background-color: #343a40;
      display: block;
    }

    h1 {
      margin: 0;
    }

    h2 {
      margin: 0;
    }

    header {
      width: 100%;
      display: block;
      background-color: #007bff;
      color: #ffffff;
      padding: 20px;
      padding-top: 20px;
      margin-bottom: 0px;
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      gap: 15px;
    }

    select,
    button,
    input {
      padding: 10px;
      margin-right: 5px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: border-color 0.3s;
    }

    button {
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      border: none;
    }

    button:hover {
      background-color: #45a049;
    }

    #backgroundImage {}

    /* Default to crescendo images; can be changed by script */
    #autoCanvas {
      width: 100%;
      background-image: url("images/crescendo_feild.png");
      background-size: contain;
      border: 1px solid #000;
      width: 1152;
      height: 498;
    }

    #teleopCanvas {
      width: 100%;
      background-image: url("images/crescendo_feild.png");
      background-size: contain;
      border: 1px solid #000;
      width: 1152;
      height: 498;
    }

    select:focus,
    button:focus,
    input:focus {
      border-color: #4CAF50;
      outline: none;
    }

    #eventCodeInput {
      background-color: #ae83e3;
      padding: 5px 10px;
      border-radius: 5px;
      margin-top: 10px;
      display: inline-block;
    }

    #newOptionContainer {
      margin-bottom: 20px;
      background-color: #ffffff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    #button-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 20px;
      width: 80%;
      margin-top: 10px;
    }

    #other-button-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 50px;
      width: 80%;
      margin-top: 10px;
    }

    #manualTeamEntry div {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    #manualTeamEntry {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    #switchTabs {
      background-color: hsl(206, 100%, 61%);
      font-size: 25px;
      padding: 0;
    }

    #clear {
      background-color: #ff6161;
      font-size: 25px;
      padding: 0px;
    }

    #matchSelect-label {
      font-size: 30px;
      font-weight: 600;
    }

    #matchSelect-container {
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .container h2 {
        text-align: center;
        margin-bottom: 20px;
      }

      #matchSelect-container {
        text-align: center;
      }

      #matchSelect {
        width: 100%;
      }
    }

    .eventAndDirections {
      display: flex;
    }

    .button {
      display: inline-block;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      outline: none;
      color: #fff;
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
    }

    .button:hover {
      background-color: #45a049
    }

    .button:active {
      background-color: #3e8e41;
    }

    #uploadMatchData {
      display: none;
    }

    .brand_con a {
      font-weight: 100;
      color: rgba(0, 0, 0, .9);
    }

    .flex-row {
      display: flex;
      flex-direction: row;
    }

    .nav_container {}

    @media screen and (max-width: 600px) {
      .flex-row {
        flex-direction: column;
      }
    }

    /* Dark Mode Toggle Switch Styles */
    .switch {
      position: relative;
      display: inline-block;
      width: 80px;
      height: 34px;
      margin: 10px;
    }

    .color_indi {
      transition: all 0.3s ease;
      box-shadow: none;
    }

    #tabLabel {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50px;
    }

    #toggleEraser {
      font-size: 25px;
      padding: 2px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: background-color .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: transform .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #555;
    }

    input:checked + .slider:before {
      transform: translateX(46px);
    }

    .icon {
      color: #fff;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      transition: opacity 0.4s;
    }

    .sun {
      left: 10px;
      opacity: 0;
    }

    .moon {
      right: 10px;
      opacity: 1;
    }

    input:checked + .slider .sun {
      opacity: 1;
    }

    input:checked + .slider .moon {
      opacity: 0;
    }

    input:not(:checked) + .slider .sun {
      opacity: 0;
    }

    input:not(:checked) + .slider .moon {
      opacity: 1;
    }

    body .bg-dark #patch-notes,
    #aboutTabsContent {
      color: #f8f9fa !important;
    }

    body .bg-dark #patch-notes h3,
    #patch-notes p,
    #patch-notes a {
      color: inherit !important;
    }

    body .bg-light #patch-notes,
    #aboutTabsContent {
      color: #343a40 !important;
    }

    body .bg-light #patch-notes h3,
    #patch-notes p,
    #patch-notes a {
      color: inherit !important;
    }

    .bg-dark,
    .navbar-dark,
    .card {
      background-color: #343a40 !important;
      color: #f8f9fa !important;
    }

    .bg-light,
    .navbar-light,
    .card {
      background-color: #f8f9fa !important;
      color: #343a40 !important;
    }

    .navbar-dark {
      background-color: #343a40 !important;
      color: #f8f9fa !important;
    }

    .navbar-dark .navbar-nav .nav-link,
    .navbar-dark .navbar-brand {
      color: #f8f9fa !important;
    }

    .nav-link.active {
      color: #343a40 !important;
    }

    .navbar-dark .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3e%3cpath stroke='rgba(248, 249, 250, 1)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
    }

    .color_con {
      flex: 1;
    }

  </style>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      document.body.style.display = "none"; // Hide body as soon as DOM is ready but not fully loaded
    });
  </script>
</head>

<body>

  <nav class="navbar navbar-expand-lg shadow-sm mb-5">
    <div class="container">
      <a class="navbar-brand" href="#" id="roborte">Robort</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="./index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./Team_List_element.html">Teams</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              Scouting
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="./Strat_Board_w_tabs.html">Canvas</a>
              <a class="dropdown-item" href="./scoutingGen.html">Scouting Generator</a>
              <a class="dropdown-item" href="./pitScouterFRONT.html">Pit Scouter</a>
              <a class="dropdown-item" href="./pitScouterBACK.html">Pit Scouter BACK</a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./Checklist.html">Pre Match Checklist</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./2423_Features.html">Features</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Config_tab.html">Configure</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="dataBaseTeamPage.html">Database</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="scoutingUI.html">ScoutingUI</a>
          </li>
        </ul>
        <label class="switch">
          <input type="checkbox" id="darkModeToggle">
          <span class="slider round">
            <span class="icon sun">ðŸŒž</span>
            <span class="icon moon">ðŸŒœ</span>
          </span>
        </label>
      </div>
    </div>
  </nav>


  <div class="controls">

    <div class="container">
      <div class="row align-items-center">
        <div class="col-sm-12 col-md-6">
          <h2>Current Event Code From <span id="storeOrConfig"></span>:
            <span id="eventCodeInput"></span>
          </h2>
        </div>
        <div class="col-sm-12 col-md-6">
          <div id="matchSelect-container" class="form-group">
            <label for="matchSelect" id="matchSelect-label">Select a match</label>
            <select id="matchSelect" class="form-control"></select>
          </div>
        </div>
      </div>

      <!-- ADDED OR MODIFIED: Game Select Dropdown -->
      <div class="row align-items-center" style="margin-top:20px;">
        <div class="col-sm-12">
          <label for="gameSelect" style="font-size: 30px; font-weight: 600;">Select a game</label>
          <select id="gameSelect" class="form-control">
            <option value="reefscape">ReefScape</option>
            <option value="crescendo" selected>Crescendo</option>
          </select>
        </div>
      </div>
      <!-- / Game Select Dropdown -->

    </div>

    <div id="other-button-container">

      <button id="saveCanvas">Save Autonomous Canvas as PNG</button>

      <input type="file" id="uploadMatchData" style="display: none;" />
      <label for="uploadMatchData" class="button">Upload Match Data</label>

      <input type="file" id="fileInput" style="display: none;" />
      <button id="toggleDataInputMode">Switch to Manual Team Entry</button>
      <div id="manualTeamEntry" style="display: none;">
        <div>
          <input type="text" id="blue1" placeholder="Blue Team 1">
          <input type="text" id="blue2" placeholder="Blue Team 2">
          <input type="text" id="blue3" placeholder="Blue Team 3">
        </div>
        <div>
          <input type="text" id="red1" placeholder="Red Team 1">
          <input type="text" id="red2" placeholder="Red Team 2">
          <input type="text" id="red3" placeholder="Red Team 3">
        </div>
        <button id="submitManualTeams">Submit Teams</button>
      </div>

    </div>

    <div id="button-container">
      <button id="clear" onclick="clearCanvas()">Clear</button>
      <button id="toggleEraser">Toggle Eraser</button>
      <button onclick="switchTabs()" id="switchTabs">Switch Tabs</button>
    </div>

    <h1 id="tabLabel">Autonomous</h1>
    <button class="color_indi" id="topRect"
      style="background-color: transparent; width: 70%; height: 100%; display: inline-block;"></button>

    <div id="backgroundImage">
      <canvas id="autoCanvas" width="1536" height="664" style="display: show;"></canvas>
      <canvas id="teleopCanvas" width="1536" height="664" style="display: none;"></canvas>
    </div>

    <button class="color_indi" id="bottomRect"
      style="background-color: transparent; width: 70%; height: 100%; display: inline-block; margin-bottom: 20px;"></button>

    <!-- About the Project Modal -->
    <div id="aboutModal" class="modal text-center modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <ul class="nav nav-tabs" id="aboutTabs" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="about-tab" data-toggle="tab" href="#about" role="tab"
                  aria-controls="about" aria-selected="true">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="patch-notes-tab" data-toggle="tab" href="#patch-notes" role="tab"
                  aria-controls="patch-notes" aria-selected="false">Patch Notes</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="feedback-tab" data-toggle="tab" href="#feedback" role="tab"
                  aria-controls="feedback" aria-selected="false">Feedback</a>
              </li>
            </ul>
            <div class="tab-content" id="aboutTabsContent">
              <div class="tab-pane fade show active" id="about" role="tabpanel" aria-labelledby="about-tab">
                <h2>Robort</h2>
                <h4>The ultimate in FRC competition gear</h4>
                <h5>Co-developed by Ben Skraly and Toba Banjo</h5>
                <p>Whether you're preparing to scout a heated match, sharing information about your team, or analyzing
                  other robots, Robort has got you covered. Complete with modular design and accessible systems, it's the
                  best tool both on and off the field.</p>
                <span>&copy; <script>document.write(new Date().getFullYear());</script> Watertown High School Robotics</span>
              </div>
              <div class="tab-pane fade" id="patch-notes" role="tabpanel" aria-labelledby="patch-notes-tab">
              </div>
              <div class="tab-pane fade" id="feedback" role="tabpanel" aria-labelledby="feedback-tab">
                <form id="feedbackForm">
                  <div class="form-group">
                    <label for="feedbackType">Select Feedback Type:</label>
                    <select class="form-control" id="feedbackType" onchange="toggleFeedbackForm()">
                      <option value="feature">Feature Suggestion</option>
                      <option value="bug">Bug Report</option>
                    </select>
                  </div>
                  <div id="featureForm" style="display: block;">
                    <div class="form-group">
                      <label>Feature Area: <label style="color:red">*</label></label>
                      <div>
                        <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="featureArea" id="statistics"
                            value="Statistics/Data">
                          <label class="form-check-label" for="statistics">Statistics/Data</label>
                        </div>
                        <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="featureArea" id="scouting"
                            value="Scouting">
                          <label class="form-check-label" for="scouting">Scouting</label>
                        </div>
                        <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="featureArea" id="quality"
                            value="Quality of Life">
                          <label class="form-check-label" for="quality">Quality of Life</label>
                        </div>
                        <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="featureArea" id="other"
                            value="Other">
                          <label class="form-check-label" for="other">Other</label>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="featureDescription">Description:</label>
                      <textarea class="form-control" id="featureDescription" rows="3"></textarea>
                    </div>
                  </div>
                  <div id="bugForm" style="display: none;">
                    <div class="form-group">
                      <label for="bugTitle">Title:</label>
                      <input type="text" class="form-control" id="bugTitle">
                    </div>
                    <div class="form-group">
                      <label for="bugSummary">Issue Summary:</label>
                      <textarea class="form-control" id="bugSummary" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                      <label for="bugSteps">Steps to Reproduce:</label>
                      <textarea class="form-control" id="bugSteps" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                      <label for="bugResults">Expected vs. Actual Results:</label>
                      <textarea class="form-control" id="bugResults" rows="2"></textarea>
                    </div>
                  </div>
                  <button type="submit" class="btn btn-primary">Submit</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <script src="jquery-3.3.1.slim.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <script src="electron.js"></script>
    <script>
      let teamPositionsAuto = [];
      let teamPositionsTeleop = [];
      let isManualEntry = false;
      let apiData = [];
      let eraserEnabled = false;
      let selectedMatchKey = "";
      let eventCode = '';
      let isAuto = true; // keep track of which tab we're on

      document.getElementById('toggleDataInputMode').addEventListener('click', function () {
        isManualEntry = !isManualEntry;
        document.getElementById('manualTeamEntry').style.display = isManualEntry ? "block" : "none";
        document.getElementById('matchSelect').style.display = isManualEntry ? "none" : "block";
        document.getElementById('matchSelect-container').style.display = isManualEntry ? "none" : "flex";
        this.textContent = isManualEntry ? "Switch to API Data Entry" : "Switch to Manual Team Entry";
      });

      document.getElementById('submitManualTeams').addEventListener('click', function () {
        const blueTeams = [
          document.getElementById('blue1').value,
          document.getElementById('blue2').value,
          document.getElementById('blue3').value
        ];
        const redTeams = [
          document.getElementById('red1').value,
          document.getElementById('red2').value,
          document.getElementById('red3').value
        ];

        if (blueTeams.some(team => team === "") || redTeams.some(team => team === "")) {
          alert("Please fill in all team numbers.");
          return;
        }

        clearCanvas();
        drawTeams(blueTeams.map(team => `frc${team}`), bluePositions, 'blue');
        drawTeams(redTeams.map(team => `frc${team}`), redPositions, 'red');
      });

      document.addEventListener('DOMContentLoaded', function () {

        const gameSelect = document.getElementById("gameSelect");
  const autoCanvas = document.getElementById("autoCanvas");
  const teleopCanvas = document.getElementById("teleopCanvas");

  // Set default value to ReefScape
  gameSelect.value = "reefscape";

  // Set default background image to ReefScape
  autoCanvas.style.backgroundImage = "url('images/reefscapefield.png')";
  teleopCanvas.style.backgroundImage = "url('images/reefscapefield.png')";

  // Listen for changes in gameSelect dropdown
  gameSelect.addEventListener("change", function () {
    if (gameSelect.value === "reefscape") {
      autoCanvas.style.backgroundImage = "url('images/reefscapefield.png')";
      teleopCanvas.style.backgroundImage = "url('images/reefscapefield.png')";
    } else if (gameSelect.value === "crescendo") {
      autoCanvas.style.backgroundImage = "url('images/crescendo_feild.png')";
      teleopCanvas.style.backgroundImage = "url('images/crescendo_feild.png')";
    }
  });
        updateSaveButton();
        const uploadButton = document.getElementById('uploadMatchData');
        const fileInput = document.getElementById('uploadMatchData');

        uploadButton.addEventListener('click', function () {
          fileInput.click(); 
        });

        fileInput.addEventListener('change', function (event) {
          uploadData(event); 
        });

      });

      document.getElementById('saveCanvas').addEventListener('click', function () {
        const canvas = isAuto ? document.getElementById('autoCanvas') : document.getElementById('teleopCanvas');
        const backgroundImage = new Image();
        backgroundImage.src = isAuto ? "images/crescendo_feild.png" : "images/crescendo_feild.png";

        // We'll override this if the user selected ReefScape:
        if (document.getElementById('gameSelect').value === 'reefscape') {
          backgroundImage.src = "images/reefscapefield.png";
        }

        const fileName = `${isAuto ? 'autonomous' : 'teleop'}-${selectedMatchKey}-canvas.png`;

        backgroundImage.onload = () => {
          const tempCanvas = document.createElement('canvas');
          const tempCtx = tempCanvas.getContext('2d');

          tempCanvas.width = canvas.width;
          tempCanvas.height = canvas.height;

          tempCtx.drawImage(backgroundImage, 0, 0, tempCanvas.width, tempCanvas.height);
          tempCtx.drawImage(canvas, 0, 0);

          const dataURL = tempCanvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = `${fileName}`;
          link.href = dataURL;
          link.click();
        };
      });

      function uploadData(event) {
        const file = event.target.files[0];
        if (!file) {
          return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
          clearPreviousData();
          const content = e.target.result;
          try {
            apiData = JSON.parse(content);
            populateMatchSelect(apiData);
          } catch (err) {
            console.error('Failed to parse uploaded file:', err);
          }
        };
        reader.readAsText(file);
      }

      document.getElementById('toggleEraser').addEventListener('click', function () {
        eraserEnabled = !eraserEnabled;
        if (isAuto) {
          ctx = ctxAuto;
        } else {
          ctx = ctxTeleop;
        }
        if (eraserEnabled) {
          ctx.globalCompositeOperation = 'destination-out';
          this.textContent = 'Switch to Pen';
        } else {
          ctx.globalCompositeOperation = 'source-over';
          this.textContent = 'Toggle Eraser';
        }
      });

      window.addEventListener("load", onPageLoad);
      const canvasAuto = document.getElementById('autoCanvas');
      const canvasTeleop = document.getElementById('teleopCanvas');
      const ctxAuto = canvasAuto.getContext('2d');
      const ctxTeleop = canvasTeleop.getContext('2d');
      const tabLabel = document.getElementById('tabLabel');
      const matchSelect = document.getElementById('matchSelect');
      let ApiDataUploaded = localStorage.getItem('ApiDataUploaded');
      let matches = [];
      let drawing = false;
      let drawColor = 'black';

      /* 
         ADDED OR MODIFIED: 
         Shifted these positions more toward the middle of the canvas y-axis
      */
      const bluePositions = [
        { x: 70,   y: 250 },
        { x: 70,   y: 350 },
        { x: 70,   y: 450 }
      ];
      const redPositions = [
        { x: 1400, y: 250 },
        { x: 1400, y: 350 },
        { x: 1400, y: 450 }
      ];

      const teamColors = {
        blue: ['#07f7df', '#075bf7', '#AD00FF'],
        red: ['#FF00A5', '#f76707', '#f7c707']
      };

      setupCanvas();

      // ADDED OR MODIFIED: Listen for game changes
      document.getElementById('gameSelect').addEventListener('change', function() {
        if (this.value === 'reefscape') {
          canvasAuto.style.backgroundImage = "url('images/reefscapefield.png')";
          canvasTeleop.style.backgroundImage = "url('images/reefscapefield.png')";
        } else {
          canvasAuto.style.backgroundImage = "url('images/crescendo_feild.png')";
          canvasTeleop.style.backgroundImage = "url('images/crescendo_feild.png')";
        }
      });

      function onPageLoad() {
        // Always start on auto
        isAuto = true;
        switchTabs(); // ensures teleop is hidden first
      }

      function switchTabs() {
        if (canvasAuto.style.display !== "none") {
          canvasTeleop.style.display = "block";
          canvasAuto.style.display = "none";
          isAuto = false;
          tabLabel.textContent = "Teleop";
        } else {
          canvasTeleop.style.display = "none";
          canvasAuto.style.display = "block";
          isAuto = true;
          tabLabel.textContent = "Autonomous";
        }
        updateSaveButton();
        redrawTeamNumbers();
      }

      function redrawTeamNumbers() {
        let ctx = isAuto ? ctxAuto : ctxTeleop;
        let teamPositions = isAuto ? teamPositionsAuto : teamPositionsTeleop;

        teamPositions.forEach(team => {
          ctx.fillStyle = team.color;
          ctx.fillRect(team.x, team.y, team.width, team.height);

          ctx.fillStyle = 'black';
          ctx.font = '40px Arial';
          const textX = team.x + (team.width - ctx.measureText(team.text).width) / 2;
          // 10 px from bottom 
          ctx.fillText(team.text, textX, team.y + team.height - 10);
        });
      }

      function updateSaveButton() {
        const saveButton = document.getElementById('saveCanvas');
        if (isAuto) {
          saveButton.textContent = 'Save Autonomous Canvas as PNG';
        } else {
          saveButton.textContent = 'Save Teleop Canvas as PNG';
        }
      }

      function setupCanvas() {
        // Mouse
        canvasAuto.addEventListener('mousedown', startDrawing);
        canvasAuto.addEventListener('mouseup', stopDrawing);
        canvasAuto.addEventListener('mouseout', stopDrawing);
        canvasAuto.addEventListener('mousemove', drawMouse);

        // Touch
        canvasAuto.addEventListener('touchstart', startDrawingTouch, false);
        canvasAuto.addEventListener('touchend', stopDrawingTouch, false);
        canvasAuto.addEventListener('touchcancel', stopDrawingTouch, false);
        canvasAuto.addEventListener('touchmove', drawTouch, false);

        // Mouse
        canvasTeleop.addEventListener('mousedown', startDrawing);
        canvasTeleop.addEventListener('mouseup', stopDrawing);
        canvasTeleop.addEventListener('mouseout', stopDrawing);
        canvasTeleop.addEventListener('mousemove', drawMouse);

        // Touch
        canvasTeleop.addEventListener('touchstart', startDrawingTouch, false);
        canvasTeleop.addEventListener('touchend', stopDrawingTouch, false);
        canvasTeleop.addEventListener('touchcancel', stopDrawingTouch, false);
        canvasTeleop.addEventListener('touchmove', drawTouch, false);
      }

      function startDrawing(e) {
        drawing = true;
        const offsetX = e.offsetX || (e.touches && e.touches[0].clientX - canvasAuto.getBoundingClientRect().left);
        const offsetY = e.offsetY || (e.touches && e.touches[0].clientY - canvasAuto.getBoundingClientRect().top);
        checkTeamClick(offsetX, offsetY);
        e.preventDefault();
      }

      function stopDrawing() {
        if (drawing) {
          drawing = false;
        }
        if (isAuto) {
          ctxAuto.beginPath();
        } else {
          ctxTeleop.beginPath();
        }
      }

      function drawMouse(e) {
        if (drawing) {
          draw(e.offsetX, e.offsetY);
        }
      }

      function startDrawingTouch(e) {
        if (e.touches.length == 1) {
          startDrawing(e);
        }
      }

      function drawTouch(e) {
        if (!drawing) return;
        if (isAuto) {
          const touch = e.touches[0];
          const offsetX = touch.clientX - canvasAuto.getBoundingClientRect().left;
          const offsetY = touch.clientY - canvasAuto.getBoundingClientRect().top;
          draw(offsetX, offsetY);
        } else {
          const touch = e.touches[0];
          const offsetX = touch.clientX - canvasTeleop.getBoundingClientRect().left;
          const offsetY = touch.clientY - canvasTeleop.getBoundingClientRect().top;
          draw(offsetX, offsetY);
        }
        e.preventDefault();
      }

      function stopDrawingTouch() {
        stopDrawing();
      }

      function draw(x, y) {
        let ctx = isAuto ? ctxAuto : ctxTeleop;
        let canvas = isAuto ? canvasAuto : canvasTeleop;
        ctx.lineWidth = eraserEnabled ? 50 : 4;
        ctx.lineCap = 'round';
        ctx.strokeStyle = eraserEnabled ? 'rgba(0,0,0,1)' : drawColor;

        const scale = canvas.width / canvas.clientWidth;
        const scaleX = x * scale;
        const scaleY = y * scale;
        ctx.lineTo(scaleX, scaleY);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(scaleX, scaleY);
      }

      function fetchMatches() {
        const eventCode = localStorage.getItem('eventCode');
        document.getElementById('eventCodeInput').textContent = eventCode;
        const webhookEndpoint = `https://www.thebluealliance.com/api/v3/event/${eventCode}/matches/simple`;
        fetch(webhookEndpoint, {
          method: "GET",
          headers: {
            "X-TBA-Auth-Key": "J43Af3iggAp3XBvsVaGm5Hbc7IlK6XR8W8WxQhLDlPiQbv6BbW8LWDvVg8Zj9fCV",
          },
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Invalid Event Code');
            }
            return response.json();
          })
          .then(data => {
            matches = data;
            apiData = data;
            populateMatchSelect(data);
            localStorage.setItem('ApiDataUploaded', JSON.stringify(apiData));
            document.getElementById('storeOrConfig').textContent = "Config";
          })
          .catch(error => {
            if (ApiDataUploaded != null && ApiDataUploaded !== "" && ApiDataUploaded !== "[]") {
              apiData = JSON.parse(ApiDataUploaded);
              populateMatchSelect(apiData);
              selectedMatchKey = matchSelect.value;
              const match = apiData.find(m => m.key === selectedMatchKey);
              eventCodeStored = match ? match.event_key : '';
              document.getElementById('storeOrConfig').textContent = "Local Storage";
              document.getElementById('eventCodeInput').textContent = `${eventCodeStored}`;
            } else {
              console.error('Error fetching matches:', error);
            }
          });
      }

      function populateMatchSelect(matches) {
        matchSelect.innerHTML = '';
        matches.sort((a, b) => {
          let compLevelA = a.comp_level + a.set_number.toString().padStart(3, '0') + a.match_number.toString().padStart(3, '0');
          let compLevelB = b.comp_level + b.set_number.toString().padStart(3, '0') + b.match_number.toString().padStart(3, '0');
          return compLevelA.localeCompare(compLevelB);
        });
        matches.forEach(match => {
          const option = document.createElement('option');
          option.value = match.key;
          option.textContent = `${match.comp_level.toUpperCase()} Match ${match.match_number}`;
          matchSelect.appendChild(option);
        });
      }

      function displayTeamsForSelectedMatch() {
        selectedMatchKey = matchSelect.value;
        const selectedMatch = apiData.find(match => match.key === selectedMatchKey);
        if (!selectedMatch) {
          console.error('Selected match not found');
          return;
        }

        clearCanvas();
        teamPositionsAuto = [];
        teamPositionsTeleop = [];

        const originalIsAuto = isAuto;

        isAuto = true;
        drawTeams(selectedMatch.alliances.blue.team_keys, bluePositions, 'blue');
        drawTeams(selectedMatch.alliances.red.team_keys, redPositions, 'red');

        isAuto = false;
        drawTeams(selectedMatch.alliances.blue.team_keys, bluePositions, 'blue');
        drawTeams(selectedMatch.alliances.red.team_keys, redPositions, 'red');

        isAuto = originalIsAuto;
      }

      const uploadInput = document.getElementById('uploadMatchData');
      uploadInput.addEventListener('change', uploadData);

      function clearPreviousData() {
        apiData = [];
      }

      function drawTeams(teamKeys, positions, alliance) {
        let ctx = isAuto ? ctxAuto : ctxTeleop;
        let teamPositions = isAuto ? teamPositionsAuto : teamPositionsTeleop;

        ctx.font = '40px Arial';
        const padding = 10;

        teamKeys.forEach((key, index) => {
          const teamNumber = key.replace('frc', '');
          const position = positions[index];
          const color = teamColors[alliance][index];

          const textMetrics = ctx.measureText(teamNumber);
          const textWidth = textMetrics.width;
          const rectHeight = 50;
          const rectY = position.y - 40;

          ctx.fillStyle = color;
          ctx.fillRect(position.x - (padding / 2), rectY, textWidth + padding, rectHeight);
          ctx.fillStyle = 'black';
          ctx.fillText(teamNumber, position.x, position.y);

          teamPositions.push({
            x: position.x - (padding / 2),
            y: rectY,
            width: textWidth + padding,
            height: rectHeight,
            color: color,
            text: teamNumber
          });
        });
      }

      function checkTeamClick(x, y) {
        let canvas = isAuto ? canvasAuto : canvasTeleop;
        const canvasRect = canvas.getBoundingClientRect();
        let scaleWidth = canvas.width / canvasRect.width;
        let scaleHeight = canvas.height / canvasRect.height;

        let scaledX = x * scaleWidth;
        let scaledY = y * scaleHeight;
        let colorFound = false;

        let teamPositions = isAuto ? teamPositionsAuto : teamPositionsTeleop;

        teamPositions.forEach(team => {
          if (
            scaledX >= team.x &&
            scaledX <= (team.x + team.width) &&
            scaledY >= team.y &&
            scaledY <= (team.y + team.height)
          ) {
            drawColor = team.color;
            colorFound = true;
            document.getElementById('topRect').style.backgroundColor = drawColor;
            document.getElementById('bottomRect').style.backgroundColor = drawColor;
          }
        });

        if (!colorFound) {
          console.log("Click was outside of team areas.");
        }
      }

      function clearCanvas() {
        let ctx = isAuto ? ctxAuto : ctxTeleop;
        let canvas = isAuto ? canvasAuto : canvasTeleop;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.globalCompositeOperation = 'source-over';
        // Redraw team numbers after clearing
        redrawTeamNumbers();
      }

      matchSelect.addEventListener('change', displayTeamsForSelectedMatch);
      fetchMatches();

      document.addEventListener("DOMContentLoaded", function() {
  const gameSelect = document.getElementById("gameSelect");
  gameSelect.value = "reefscape"; // Ensure the placeholder is selected initially
});
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {

        const toggle = document.getElementById('darkModeToggle');
        const body = document.body;
        const navbar = document.querySelector('.navbar');
        const teleopCanvas = document.getElementById('teleopCanvas');
        const autoCanvas = document.getElementById('autoCanvas');

        function enableDarkMode() {
          body.classList.add('bg-dark');
          body.classList.remove('bg-light');
          navbar.classList.add('navbar-dark');
          navbar.classList.remove('navbar-light', 'bg-white');
          autoCanvas.style.backgroundImage = "url('images/crescendo_feild_dark.png')";
          teleopCanvas.style.backgroundImage = "url('images/crescendo_feild_dark.png')";
          document.querySelectorAll('.navbar').forEach(element => {
            element.classList.add('bg-dark');
            element.classList.remove('bg-white');
          });
          document.querySelectorAll('.form-control').forEach(element => {
            element.classList.add('bg-dark');
            element.classList.remove('bg-white');
          });
        }

        function disableDarkMode() {
          body.classList.add('bg-light');
          body.classList.remove('bg-dark');
          navbar.classList.add('navbar-light');
          navbar.classList.remove('navbar-dark', 'bg-dark');
          autoCanvas.style.backgroundImage = "url('images/crescendo_feild.png')";
          teleopCanvas.style.backgroundImage = "url('images/crescendo_feild.png')";
          document.querySelectorAll('.navbar').forEach(element => {
            if (!element.closest('#aboutModal')) {
              element.classList.add('bg-white');
              element.classList.remove('bg-dark');
            }
          });
          document.querySelectorAll('.form-control').forEach(element => {
            if (!element.closest('#aboutModal')) {
              element.classList.remove('bg-dark');
              element.classList.add('bg-white');
            }
          });
        }

        if (localStorage.getItem('darkMode') === 'true') {
          enableDarkMode();
          toggle.checked = true;
        } else {
          disableDarkMode();
        }
        body.style.display = 'block';

        toggle.addEventListener('change', function() {
          if (this.checked) {
            localStorage.setItem('darkMode', 'true');
            enableDarkMode();
          } else {
            localStorage.setItem('darkMode', 'false');
            disableDarkMode();
          }
        });
      });

      document.getElementById('roborte').addEventListener('click', function() {
        $('#aboutModal').modal('show');
      });

      function loadGitHubReleases() {
        const apiUrl = 'https://api.github.com/repos/skac121245/Robort/releases';
        const converter = new showdown.Converter();
        fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('patch-notes');
            container.innerHTML = '';
            data.forEach(release => {
              if (release.body !== null) {
                const markdownHTML = converter.makeHtml(release.body);
                const releaseDiv = document.createElement('div');
                releaseDiv.innerHTML = `
                  <h3>${release.tag_name}</h3>
                  <div>${markdownHTML}</div>
                  <a href="${release.html_url}" target="_blank">View on GitHub</a>
                  <hr>`;
                container.appendChild(releaseDiv);
              }
            });
          })
          .catch(error => console.error('Error fetching GitHub releases:', error));
      }

      document.getElementById('patch-notes-tab').addEventListener('click', function() {
        loadGitHubReleases();
      });

      document.getElementById('feedbackForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const feedbackType = document.getElementById('feedbackType').value;
        let postData = {
          username: "Robort Feedback Bot",
          embeds: [],
        };

        if (feedbackType === 'feature') {
          const area = document.querySelector('input[name="featureArea"]:checked').value;
          const description = document.getElementById('featureDescription').value;
          postData.embeds.push({
            title: "Feature Suggestion",
            fields: [
              { name: "Area", value: area, inline: true },
              { name: "Description", value: description }
            ],
            color: 65280
          });
        } else {
          const title = document.getElementById('bugTitle').value;
          const summary = document.getElementById('bugSummary').value;
          const steps = document.getElementById('bugSteps').value;
          const results = document.getElementById('bugResults').value;
          postData.embeds.push({
            title: "Bug Report: " + title,
            fields: [
              { name: "Summary", value: summary },
              { name: "Steps to Reproduce", value: steps },
              { name: "Expected vs. Actual Results", value: results }
            ],
            color: 16711680
          });
        }

        try {
          const response = await fetch('https://discord.com/api/webhooks/1231365349476405268/lX0MXxHO2zwQPnNxEiuConQ8Sf47Qwq4EDrE8mLV8pctu3c63VQBjnsjAwlGLK2DPeLm', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(postData)
          });
          if (response.ok) {
            alert('Feedback submitted successfully!');
            document.getElementById('feedbackForm').reset();
          } else {
            alert('Failed to submit feedback. Please try again.');
          }
        } catch (error) {
          console.error('Error submitting feedback:', error);
          alert('Error submitting feedback. Please check your network connection and try again.');
        }
      });

      function toggleFeedbackForm() {
        const feedbackType = document.getElementById('feedbackType').value;
        if (feedbackType === 'feature') {
          document.getElementById('featureForm').style.display = 'block';
          document.getElementById('bugForm').style.display = 'none';
        } else {
          document.getElementById('featureForm').style.display = 'none';
          document.getElementById('bugForm').style.display = 'block';
        }
      }
    </script>
    <script>
      window.onload = function() {
        document.body.style.display = "block";
      };
    </script>
</body>

</html>
