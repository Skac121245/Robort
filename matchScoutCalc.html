<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robort</title>
    <!-- Include Bootstrap CSS from a CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom styles for making the table wider and enhancing column separation */
        .wide-table {
            width: 100%; /* Makes the table full width */
        }
        .wide-table th, .wide-table td {
            border-right: 2px solid #000000; /* Adds a defining line between columns */
        }
        .wide-table th:last-child, .wide-table td:last-child {
            border-right: none; /* Removes the border from the last column */
        }
    </style>
</head>
<body class="container py-4">
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
        <div class="container">
            <a class="navbar-brand" href="./index.html">Robort</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./Team_List_element.html">Teams</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./Strat_Board_w_tabs.html">Canvas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./Checklist.html">Pre Match Checklist</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./2423_Features.html">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Config_tab.html">Configure</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <h1 class="mb-3">FRC Scouting Scheduler</h1>
    <div class="mb-3">
       <h2>Current Event Code From<span id="config_or_local"></span><span id="eventCode"></span></h2>
    </div>
    <div class="mb-3">
        <label for="teamsPerMatch" class="form-label">Teams to scout per match:</label>
        <input type="number" id="teamsPerMatch" class="form-control" min="1" value="3">
    </div>
    <button onclick="fetchMatches()" class="btn btn-primary">Fetch Matches</button>

    <div id="schedule" class="mt-4"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
    // On page load, set the event code from local storage if available
    const eventCode = localStorage.getItem('eventCode');
    if (eventCode) {
        document.getElementById('eventCode').textContent = eventCode;
    }
});

async function fetchMatches() {
    const eventCode = localStorage.getItem('eventCode');
    const teamsPerMatch = parseInt(document.getElementById('teamsPerMatch').value, 10);

    if (!eventCode) {
        alert('Please enter an event code.');
        return;
    }

    try {
        const response = await fetch(`https://www.thebluealliance.com/api/v3/event/${eventCode}/matches/simple`, {
            headers: {
                'X-TBA-Auth-Key': 'J43Af3iggAp3XBvsVaGm5Hbc7IlK6XR8W8WxQhLDlPiQbv6BbW8LWDvVg8Zj9fCV'
            }
        });

        if (!response.ok) {
            throw new Error('Failed to fetch data. Please check the event code and your network connection.');
        }

        const matches = await response.json();
        if (!matches.length) {
            document.getElementById('schedule').innerHTML = '<div class="alert alert-warning">No matches found for this event.</div>';
            return;
        }

        // Process and display matches
        processMatches(matches.filter(match => match.comp_level === 'qm'), teamsPerMatch);
    } catch (error) {
        document.getElementById('schedule').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
    }
}

function processMatches(matches, teamsPerMatch) {
    matches.sort((a, b) => a.match_number - b.match_number);

    const teams = {};
    matches.forEach(match => {
        ['blue', 'red'].forEach(color => {
            match.alliances[color].team_keys.forEach(teamKey => {
                const teamNumber = teamKey.replace('frc', '');
                if (!teams[teamNumber]) {
                    teams[teamNumber] = [];
                }
                teams[teamNumber].push(`QM ${match.match_number}`);
            });
        });
    });

    const scoutingSchedule = {};
    matches.forEach(match => {
        const matchKey = `QM ${match.match_number}`;
        scoutingSchedule[matchKey] = [];
    });

    Object.keys(teams).forEach(team => {
        teams[team].forEach(matchKey => {
            if (scoutingSchedule[matchKey].length < teamsPerMatch) {
                scoutingSchedule[matchKey].push(team);
            }
        });
    });

    renderSchedule(scoutingSchedule);
}

function renderSchedule(scoutingSchedule) {
    let scheduleHtml = `<h2>Scouting Schedule</h2>
                        <table class="table table-hover wide-table">
                        <thead class="table-dark">
                            <tr><th>Match</th><th>Teams to Scout</th></tr>
                        </thead>
                        <tbody>`;
    Object.keys(scoutingSchedule).sort((a, b) => parseInt(a.slice(3)) - parseInt(b.slice(3))).forEach(match => {
        scheduleHtml += `<tr><td>${match}</td><td>${scoutingSchedule[match].join(', ')}</td></tr>`;
    });

    scheduleHtml += `</tbody></table>`;
    document.getElementById('schedule').innerHTML = scheduleHtml;
}

    </script>
</body>
</html>
<!-- </html> J43Af3iggAp3XBvsVaGm5Hbc7IlK6XR8W8WxQhLDlPiQbv6BbW8LWDvVg8Zj9fCV -->