<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRC Scouting App - Autonomous Mode</title>
    <style>
        #field {
            width: 100%;
            /* background-image: url('https://www.chiefdelphi.com/uploads/default/original/3X/a/a/aa745548020a507cf4a07051dcd0faa446607840.png'); */
            background-image: url("images/crescendo_feild.png");
            background-size: contain;
            border: 1px solid #000;
            width: 1152px;
            /* Adjust based on your actual need */
            height: 498px;
            /* Adjust based on your actual need */
            position: relative;
            left: 25%;
        }

        #position-btn-p1, #position-btn-p2, #position-btn-p3, #position-btn-p4,
        #driver-station-btn-1, #driver-station-btn-2, #driver-station-btn-3 {
            position: absolute;
            background-color: rgba(0, 123, 255, 0.5);
            /* Semi-transparent blue */
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #position-btn-p5, #position-btn-p6, #position-btn-p7, #position-btn-p8, #driver-station-btn-4, #driver-station-btn-5, #driver-station-btn-6 {
            position: absolute;
            background-color: rgba(255, 65, 65, 0.6);
            /* Semi-transparent blue */
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .position-btn:hover,
        .driver-station-btn:hover {
            background-color: rgba(0, 123, 255, 0.8);
        }

        .driver-station-btn {
            left: 1%;
        }

        #info {
            margin-top: 20px;
            padding-bottom: 20px;
            text-align: center;
        }

        .position-btn.red,
        .driver-station-btn.red {
            background-color: rgba(255, 0, 0, 0.5);
            /* Semi-transparent red */
        }

        .position-btn.red:hover,
        .driver-station-btn.red:hover {
            background-color: rgba(255, 0, 0, 0.8);
        }

        #notesContainer .note-btn {
            background-color: rgba(0, 200, 150, 0.5);
            border: none;
            color: white;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #notesContainer .note-btn:hover {
            background-color: rgba(0, 200, 150, 0.8);
        }

        #noteOutcome button {
            margin: 0 5px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        #noteOutcome button:hover {
            background-color: #45a049;
        }

        #teleopContainer button {
            margin: 10px;
            padding: 8px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        #teleopContainer button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div id="info">
        <label for="sideToggle">Toggle Side:</label>
        <input type="checkbox" id="sideToggle" onchange="toggleSide()">
        <input type="number" id="matchNumber" placeholder="Match Number">
        <input type="number" id="teamNumber" placeholder="Team Number">
        <button onclick="startScouting()">Start Scouting</button>
        <button onclick="startTeleop()">Start Teleop</button>
        <button onclick="startEndgame()">Start Endgame</button>
        <button onclick="downloadSessionStorageData()">Download Data</button>
    </div>
    <div id="field">
        <button id="driver-station-btn-1" class="driver-station-btn" style="top: 18%; width:120px;">Driver Station 1 BLUE</button>
        <button id="driver-station-btn-2" class="driver-station-btn" style="top: 53%; width:120px;">Driver Station 2 BLUE</button>
        <button id="driver-station-btn-3" class="driver-station-btn" style="top: 72%; width: 120px;">Driver Station 3 BLUE</button>

        <button id="driver-station-btn-6" class="driver-station-btn" style="top: 18%; left: 90%;">Driver Station 3 RED</button>
        <button id="driver-station-btn-5" class="driver-station-btn" style="top: 53%; left: 90%;">Driver Station 2 RED</button>
        <button id="driver-station-btn-4" class="driver-station-btn" style="top: 72%; left: 90%;">Driver Station 1 RED</button>

        <button id="position-btn-p1" class="position-btn" style="top: 20%; left: 15%;">Position 1</button>
        <button id="position-btn-p2" class="position-btn" style="top: 35%; left: 18%;">Position 2</button>
        <button id="position-btn-p3" class="position-btn" style="top: 50%; left: 15%;">Position 3</button>
        <button id="position-btn-p4" class="position-btn" style="top: 70%; left: 15%;">Position 4</button>

        <button id="position-btn-p5" class="position-btn" style="top: 20%; left: 78%;">Position 5</button>
        <button id="position-btn-p6" class="position-btn" style="top: 35%; left: 75%;">Position 6</button>
        <button id="position-btn-p7" class="position-btn" style="top: 50%; left: 78%;">Position 7</button>
        <button id="position-btn-p8" class="position-btn" style="top: 70%; left: 78%;">Position 8</button>


        <div id="teleopContainer" style="display: none; position: absolute; width: 100%; ">
            <button id="groundPickupButton"
                style="background-color:green; position:absolute; top: 45px; left: 40.5%; width: 200px; height: 419px; opacity: 60%;"
                onclick="logAction('Ground Pickup')">Ground Pickup</button>
            <button id="sourceButton"
                style="position:absolute; top: 390px; left: 75%; width: 100px; height: 50px; rotate: -30deg; opacity: 60%;"
                onclick="logAction('Source BLUE')">Source</button>
            <button id="sourceButton2"
                style=" background-color:red; position:absolute; top: 390px; left: 15%; width: 100px; height: 50px; rotate: 30deg; opacity: 60%;"
                onclick="logAction('Source RED')">Source</button>

            <div id="additionalActions" style="display: none;">
                <button style="position:absolute; top: 130px; left: 10%; width: 100px; height:100px; opacity: 60%;"
                    onclick="logAction('Speaker')">Speaker</button>
                <button style="position:absolute; top: 0px; left: 16%; width: 100px; height:50px; opacity: 60%;"
                    onclick="logAction('Amp')">Amp</button>
                <button style="position:absolute; top: 80px; left: 25%; width: 100px; height:100px; opacity: 60%;"
                    onclick="logAction('Pass')">Pass</button>
            </div>

            <div id="endgameContainer" style="display: none; text-align: center;">
                <button style="position:absolute; top: 300px; left: 25%; width: 100px; height:50px; opacity: 60%;" onclick="logEndgameAction('Stage Right BLUE')">Stage Right</button>
                <button style="position:absolute; top: 160px; left: 25%; width: 100px; height:50px; opacity: 60%;" onclick="logEndgameAction('Stage Left BLUE')">Stage Left</button>
                <button style="position:absolute; top: 225px; left: 38%; width: 100px; height:50px; opacity: 60%;" onclick="logEndgameAction('Center Stage BLUE')">Center Stage</button>
                <button style="background-color:green; position:absolute; top: 80px; left: 25%; width: 100px; height:50px; opacity: 60%;" onclick="logEndgameAction('None')">None</button>

                <button style="position:absolute; top: 300px; left: 63%; width: 100px; height:50px; opacity: 60%;" onclick="logEndgameAction('Stage Right RED')">Stage Right</button>
                <button style="position:absolute; top: 160px; left: 63%; width: 100px; height:50px; opacity: 60%;" onclick="logEndgameAction('Stage Left RED')">Stage Left</button>
                <button style="position:absolute; top: 225px; left: 51%; width: 100px; height:50px; opacity: 60%;" onclick="logEndgameAction('Center Stage RED')">Center Stage</button>

                <div id="endgameOutcome" style="display: none; text-align: center;">
                    <button onclick="saveEndgameOutcome('Park')">Park</button>
                    <button onclick="saveEndgameOutcome('Climb')">Climb</button>
                    <button onclick="saveEndgameOutcome('Harmony')">Harmony</button>
                    <button onclick="saveEndgameOutcome('Trap')">Trap</button>
                    <button onclick="saveEndgameOutcome('None')">None</button>

                </div>
            </div>



        </div>
        <div id="notesContainer" style="display: none; position: relative; width: 100%; height: 100%;">
            <!-- Example note buttons, position these as needed -->
            <button class="note-btn" style="position: absolute; top: 20%; left: 23%;"
                onclick="noteAction('Note 1')">Note
                1</button>
            <button class="note-btn" style="position: absolute; top: 35%; left: 23%;"
                onclick="noteAction('Note 2')">Note
                2</button>
            <button class="note-btn" style="position: absolute; top: 50%; left: 23%;"
                onclick="noteAction('Note 3')">Note
                3</button>
            <button class="note-btn" style="position: absolute; top: 16%; left: 47%;"
                onclick="noteAction('Note 4')">Note
                4</button>
            <button class="note-btn" style="position: absolute; top: 33%; left: 47%;"
                onclick="noteAction('Note 5')">Note
                5</button>
            <button class="note-btn" style="position: absolute; top: 50%; left: 47%;"
                onclick="noteAction('Note 6')">Note
                6</button>
            <button class="note-btn" style="position: absolute; top: 67%; left: 47%;"
                onclick="noteAction('Note 7')">Note
                7</button>
            <button class="note-btn" style="position: absolute; top: 85%; left: 47%;"
                onclick="noteAction('Note 8')">Note
                8</button>
            <button class="note-btn" style="position: absolute; top: 20%; left: 71%;"
                onclick="noteAction('Note 9')">Note
                9</button>
            <button class="note-btn" style="position: absolute; top: 35%; left: 71%;"
                onclick="noteAction('Note 10')">Note
                10</button>
            <button class="note-btn" style="position: absolute; top: 50%; left: 71%;"
                onclick="noteAction('Note 11')">Note
                11</button>
            <!-- Add more note buttons as required -->
        </div>
    </div>
    <div id="noteOutcome"
        style="display: none; padding-top:20px; position: absolute;  left: 50%; transform: translateX(-50%);">
        <button onclick="saveNoteOutcome('scored')">Scored</button>
        <button onclick="saveNoteOutcome('missed')">Missed</button>
        <button onclick="saveNoteOutcome('not picked up')">Not Picked Up</button>
        <button onclick="saveNoteOutcome('another team got it')">Another Team Got It</button>
    </div>
    <script>
        document.querySelectorAll('.position-btn').forEach(button => {
            button.addEventListener('click', function () {
                const position = this.innerText;
                selectPosition(position);
            });
        });

        function toggleSide() {
            const isChecked = document.getElementById('sideToggle').checked;
            const maxLeft = 78; // Maximum left percentage for red side
            const minLeft = 15; // Minimum left percentage for blue side

            // Calculate new positions for driver stations
            const driverStationPositions = {
                "Driver Station 1": "72%", // DS 1 becomes DS 3
                "Driver Station 2": "53%", // DS 2 remains DS 2
                "Driver Station 3": "18%"  // DS 3 becomes DS 1
            };

            document.querySelectorAll('.position-btn, .driver-station-btn').forEach(button => {
                if (isChecked) {
                    // Change to red side
                    if (button.classList.contains('driver-station-btn')) {
                        button.style.top = driverStationPositions[button.innerText]; // Update top position based on mapping
                    }
                    const currentLeft = parseInt(button.style.left, 10);
                    const newLeft = maxLeft - (currentLeft - minLeft);
                    button.style.left = `${newLeft}%`;
                    button.classList.add('red');
                } else {
                    // Change to blue side (reverse operation for driver stations)
                    const driverStationReversePositions = {
                        "Driver Station 1": "18%", // DS 3 goes back to DS 1
                        "Driver Station 2": "53%", // DS 2 remains DS 2
                        "Driver Station 3": "72%"  // DS 1 goes back to DS 3
                    };
                    if (button.classList.contains('driver-station-btn')) {
                        button.style.top = driverStationReversePositions[button.innerText];
                    }
                    const currentLeft = parseInt(button.style.left, 10);
                    const newLeft = minLeft + (maxLeft - currentLeft);
                    button.style.left = `${newLeft}%`;
                    button.classList.remove('red');
                }
            });
        }

        document.querySelectorAll('.driver-station-btn').forEach(button => {
            button.addEventListener('click', function () {
                const driverStation = this.innerText;
                selectDriverStation(driverStation);
            });
        });

        function downloadSessionStorageData() {
            // Retrieve the scouting data from session storage
            const scoutingData = sessionStorage.getItem('scoutingData');
            if (scoutingData) {
                const data = JSON.parse(scoutingData);
                const matchNumber = data.matchNumber;
                const teamNumber = data.teamNumber;
                const filename = `Match${matchNumber}_${teamNumber}_ScoutingData.json`;

                // Create a blob from the data
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });

                // Create an anchor element and use it to trigger the download
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = filename;
                a.style.display = 'none';

                // Append the anchor to the body, click it, and then remove it
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } else {
                alert('No scouting data available to download!');
            }
        }

        function selectDriverStation(driverStation) {
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData') || '{}');
            scoutingData.driverStation = driverStation;
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));
            checkSelections();
        }

        function selectPosition(position) {
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData') || '{}');
            scoutingData.robotPosition = position;
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));
            checkSelections();
        }

        function checkSelections() {
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData') || '{}');
            if (scoutingData.driverStation && scoutingData.robotPosition) {
                // Hide position and driver station buttons
                document.querySelectorAll('.position-btn, .driver-station-btn').forEach(button => {
                    button.style.display = 'none';
                });
                // Show notes container
                document.getElementById('notesContainer').style.display = 'block';
            }
        }

        function noteAction(note) {
            console.log('Note action for:', note);
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData'));
            if (!scoutingData.notes) {
                scoutingData.notes = [];
                scoutingData.autoActions = [];
            }
            scoutingData.notes.push(note);
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));

            // Show the note outcome options
            document.getElementById('noteOutcome').style.display = 'block';
            // Store the current note globally or in the session for outcome processing
            sessionStorage.setItem('currentNote', note);
        }

        function saveNoteOutcome(outcome) {
            const note = sessionStorage.getItem('currentNote');
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData'));
            // Append the outcome to the corresponding note
            if (!scoutingData.autoActions) {
                scoutingData.autoActions = [];
            }
            scoutingData.autoActions.push({ note: note, outcome: outcome });
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));

            // Hide the outcome buttons until the next note is selected
            document.getElementById('noteOutcome').style.display = 'none';
        }

        function startScouting() {
            const matchNumber = document.getElementById('matchNumber').value;
            const teamNumber = document.getElementById('teamNumber').value;
            if (matchNumber && teamNumber) {
                const scoutingData = {
                    matchNumber: matchNumber,
                    teamNumber: teamNumber,
                    actions: []
                };
                sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));
                alert('Scouting started!');
            } else {
                alert('Please enter both match and team numbers.');
            }
        }

        function startTeleop() {
            // Hide all note buttons and show Teleop actions
            document.getElementById('notesContainer').style.display = 'none';
            document.getElementById('noteOutcome').style.display = 'none'; // Hide outcomes if visible
            document.getElementById('teleopContainer').style.display = 'block';


            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData'));
            scoutingData.teleopActions = [];
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));
        }

        function logAction(action) {
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData'));

            // Check if the action is a pickup (Ground Pickup or Source)
            if (action === 'Ground Pickup' || action === 'Source BLUE' || action === 'Source RED') {
                // Store the pickup action directly to teleopActions with a placeholder for shot/place
                scoutingData.teleopActions.push({ pickup: action, shot_place: null });

                // Temporarily store the index of this action to link with its corresponding shot/place
                scoutingData.currentActionIndex = scoutingData.teleopActions.length - 1;

                // Show additional options for what happens after the pickup
                showAdditionalActions();
            } else {
                // If it's a shot/place action (Speaker, Amp, Pass), pair it with the last recorded pickup
                if (typeof scoutingData.currentActionIndex !== 'undefined') {
                    // Access the current action object and update it with the shot/place action
                    scoutingData.teleopActions[scoutingData.currentActionIndex].shot_place = action;

                    // Clear the temporary index after updating to prepare for the next series of actions
                    delete scoutingData.currentActionIndex;

                    // After logging a shot/place, revert to showing the initial pickup options
                    hideAdditionalActions();
                }
            }

            // Save the updated scouting data back to sessionStorage
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));
            console.log(action + ' action logged.');
        }


        function showAdditionalActions() {
            // Hide initial Teleop buttons and show additional actions
            document.getElementById('groundPickupButton').style.display = 'none';
            document.getElementById('sourceButton').style.display = 'none';
            document.getElementById('sourceButton2').style.display = 'none';
            document.getElementById('additionalActions').style.display = 'block';
        }


        function hideAdditionalActions() {
            // Hide additional actions and show initial Teleop buttons again
            document.getElementById('additionalActions').style.display = 'none';
            document.getElementById('groundPickupButton').style.display = 'inline';
            document.getElementById('sourceButton').style.display = 'inline';
            document.getElementById('sourceButton2').style.display = 'inline';

        }

        function logTeleopAction(action) {
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData'));
            if (!scoutingData.teleopActions) {
                scoutingData.teleopActions = [];
            }
            scoutingData.teleopActions.push(action);
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));

            // Hide additional actions and show initial Teleop buttons again
            document.getElementById('additionalActions').style.display = 'none';
            document.getElementById('groundPickupButton').style.display = 'inline';
            document.getElementById('sourceButton').style.display = 'inline';

            console.log(action + ' action logged in Teleop.');
        }

        function startEndgame() {
            // Show endgame buttons
            document.getElementById('endgameContainer').style.display = 'block';
            document.getElementById('additionalActions').style.display = 'none';
            document.getElementById('groundPickupButton').style.display = 'none';
            document.getElementById('sourceButton').style.display = 'none';
            document.getElementById('sourceButton2').style.display = 'none';
        

            // Hide the "Start Endgame" button to prevent multiple endgame starts
            document.querySelector('button[onclick="startEndgame()"]').style.display = 'none';
        }

        function logEndgameAction(action) {
            // Store the endgame action and show the secondary buttons
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData')) || {};
            scoutingData.endgameAction = action;
            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));

            console.log(action + ' endgame action logged.');

            // Show the secondary endgame outcome buttons
            document.getElementById('endgameOutcome').style.display = 'block';
        }

        function saveEndgameOutcome(outcome) {
            // Retrieve the endgame action and append the outcome to it
            const scoutingData = JSON.parse(sessionStorage.getItem('scoutingData')) || {};
            const endgameAction = scoutingData.endgameAction || {};
            scoutingData.endgameActions = scoutingData.endgameActions || [];
            scoutingData.endgameActions.push({ action: endgameAction, outcome: outcome });

            sessionStorage.setItem('scoutingData', JSON.stringify(scoutingData));

            console.log(endgameAction + ' endgame action outcome logged as ' + outcome + '.');

            // Hide the endgameOutcome buttons and the endgame action buttons
            document.getElementById('endgameOutcome').style.display = 'none';
            document.getElementById('endgameContainer').style.display = 'none';
        }

    </script>
</body>

</html>