<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre Match Checklist</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        nav {
            margin-bottom: 20px;
        }

        .navbar-light .navbar-nav .nav-link {
            color: #15a801;
        }

        .navbar-light .navbar-nav .nav-link:hover {
            color: #02467e;
        }

        #checklistContainer {
            padding: 20px;
            background: #ffffff;
            border-radius: 0.25rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        }

        .checklist-item {
            margin-bottom: 10px;
        }

        .checklist-item label {
            font-size: 1.125rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .form-control {
            border-radius: 0.25rem;
        }

        .btn, .upload-btn {
            cursor: pointer;
        }

        .btn-primary, .upload-btn {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-primary:hover, .upload-btn:hover {
            color: #fff;
            background-color: #0069d9;
            border-color: #0062cc;
        }

        .btn-success {
            color: #fff;
            background-color: #28a745;
            border-color: #28a745;
        }

        .btn-success:hover {
            color: #fff;
            background-color: #218838;
            border-color: #1e7e34;
        }

        input[type="file"] {
            display: none;
        }
       

/* Ensure uniform size and margin for buttons and labels */
.button-wrapper label {
    margin: 0; /* Override default margins if necessary */
    height: 38px; /* Adjust based on your design needs */
    display: inline-flex; /* Align text and icons within buttons/labels */
    align-items: center; /* Center items vertically inside the button/label */
    justify-content: center; /* Center items horizontally inside the button/label */
}
.upload-success-alert {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    visibility: hidden; /* Initially hidden */
    opacity: 0;
    z-index: 1051; /* Higher than Bootstrap modals */
    transition: visibility 0s linear 0.5s, opacity 0.5s linear; /* Delay visibility change */
    background-color: #d4edda; /* Light green background */
    color: #155724; /* Dark green text */
    border-color: #c3e6cb;
    padding: 0.75rem 1.25rem;
    border-radius: 0.25rem;
}

.upload-success-alert.show {
    visibility: visible;
    opacity: 1;
    transition: opacity 0.5s linear;
}
    </style>
</head>
<body>
   <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Pre Match Checklist</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <a class="nav-item nav-link" href="./index.html">Home <span class="sr-only">(current)</span></a>
            <a class="nav-item nav-link" href="./Team_List_element.html">Teams</a>
            <a class="nav-item nav-link" href="./Strat_Board_w_tabs.html">Canvas</a>
            <a class="nav-item nav-link active" href="./Checklist.html">Pre Match Checklist</a>
            <a class="nav-item nav-link" href="./Control_Panel.html">Control Panel</a>
            <a class="nav-item nav-link" href="./2423_Features.html">Features</a>
            <a class="nav-item nav-link" href="./Config_tab.html">Configure</a>
        </div>
    </div>
</nav>
    <div class="container mt-4" id="checklistContainer">
        <!-- Checklist items will be dynamically inserted here -->
    </div>
    
    <div class="container mt-4 justify-content-between button-wrapper">
        <form id="addItemForm" class="mb-3">
            <div class="input-group mb-3">
                <input type="text" id="newItems" class="form-control" placeholder="Enter items separated by spaces" aria-label="Checklist item">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="submit">Add Items</button>
                </div>
            </div>
        </form>
        <button id="clearChecklist" class="btn btn-danger" data-toggle="modal" data-target="#clearModal">Clear Checklist</button>
        <button id="downloadChecklist" class="btn btn-success">Download Checklist</button>
        <input type="file" id="uploadChecklist">
        <input type="file" id="uploadChecklistInput" style="display: none;">
<label for="uploadChecklistInput" class="btn btn-info upload-btn">Upload Checklist</label>

    </div>
    <!-- Add Bootstrap Modal for Clear Confirmation -->
    <div class="modal fade" id="clearModal" tabindex="-1" role="dialog" aria-labelledby="clearModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clearModalLabel">Clear Checklist</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to clear the checklist? This action will remove all items from local storage.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmClear">Clear Checklist</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">Upload Error</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="errorModalBody">
                The file is not valid JSON.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const checklistContainer = document.getElementById('checklistContainer');
            const addItemForm = document.getElementById('addItemForm');
            const newItemsInput = document.getElementById('newItems');
            let checklistItems = [];
            loadChecklist();

            function renderChecklist(items) {
                checklistContainer.innerHTML = '';
                items.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'checklist-item form-check';
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = 'check-' + index;
                    checkbox.className = 'form-check-input';
                    const label = document.createElement('label');
                    label.htmlFor = 'check-' + index;
                    label.className = 'form-check-label';
                    label.textContent = typeof item === 'object' ? item.text : item;
                    div.appendChild(checkbox);
                    div.appendChild(label);
                    checklistContainer.appendChild(div);
                // Listener to update localStorage when an item is checked/unchecked
        checkbox.addEventListener('change', () => {
            checklistItems[index].checked = checkbox.checked; // Update the 'checked' state
            localStorage.setItem('preMatchChecklistItems', JSON.stringify(checklistItems)); // Save updated list
        });
    });
            }

            document.getElementById('confirmClear').addEventListener('click', function() {
    checklistItems = []; // Clear the array
    localStorage.removeItem('preMatchChecklistItems'); // Clear local storage
    renderChecklist(checklistItems); // Re-render the checklist (now empty)
    $('#clearModal').modal('hide'); // Hide the confirmation modal
});
function loadChecklist() {
    const storedItems = JSON.parse(localStorage.getItem('preMatchChecklistItems'));
    if (storedItems) {
        checklistItems = storedItems;
    } else {
        checklistItems = [];
    }
    renderChecklist(checklistItems);
}


addItemForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const newItems = newItemsInput.value.split(' ');
    checklistItems = checklistItems.concat(newItems.filter(item => item.trim() !== '')); // Filter out any empty strings
    localStorage.setItem('preMatchChecklistItems', JSON.stringify(checklistItems)); // Save updated list to localStorage
    renderChecklist(checklistItems);
    newItemsInput.value = '';
});


            const downloadChecklistButton = document.getElementById('downloadChecklist');
            const uploadChecklistInput = document.getElementById('uploadChecklist');

            downloadChecklistButton.addEventListener('click', function() {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(checklistItems));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "checklistItems.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            });

            document.getElementById('uploadChecklistInput').addEventListener('change', function(e) {
    const fileReader = new FileReader();
    fileReader.onload = function() {
        try {
            const contents = JSON.parse(fileReader.result);
            checklistItems = contents;
            renderChecklist(checklistItems);
            localStorage.setItem('preMatchChecklistItems', JSON.stringify(checklistItems));
            showSuccessAlert('Upload success!');
        } catch (error) {
            console.error("Error parsing uploaded file as JSON:", error);
            // Show error modal instead of alert
            showErrorModal("Upload failed: The file is not a valid JSON.");
        }
    };
    if (e.target.files[0]) {
        fileReader.readAsText(e.target.files[0]);
    }
});

// Function to display the error modal with a custom message
function showErrorModal(errorMessage) {
    document.getElementById('errorModalBody').textContent = errorMessage; // Set the error message
    $('#errorModal').modal('show'); // Use jQuery to show the modal
}



        });

        function showSuccessAlert(message) {
    const alertBox = document.createElement('div');
    alertBox.className = 'alert alert-success upload-success-alert';
    alertBox.innerHTML = `<span class="mr-2">&#10003;</span>${message}`;
    document.body.appendChild(alertBox);

    // Trigger reflow to ensure the transition can happen
    alertBox.offsetHeight; // Read offsetHeight to force reflow

    // Start fade in
    alertBox.classList.add('show');

    // Start fade out after a delay
    setTimeout(() => {
        alertBox.classList.remove('show');

        // Remove the element after the fade-out transition completes
        setTimeout(() => {
            document.body.removeChild(alertBox);
        }, 500); // Match the CSS transition duration
    }, 3000); // Visible duration before starting fade-out
}
    </script>
<script src="jquery-3.3.1.slim.min.js"></script>
<script src="bootstrap.min.js"></script>
</body>
</html>
