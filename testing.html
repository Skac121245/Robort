<!DOCTYPE html>
<html>
<head>
  <title>FRC Match Strategy Planner</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    #strategyCanvas {
      background-image: url('https://www.chiefdelphi.com/uploads/default/original/3X/a/a/aa745548020a507cf4a07051dcd0faa446607840.png');
      background-size: contain;
      border: 1px solid #000;
      width: 1536px; /* Adjust based on your actual need */
      height: 664px; /* Adjust based on your actual need */
    }

    .controls {
      margin-top: 20px;
    }

    select, button, input {
      padding: 10px;
      margin-right: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>

<div class="controls">
  <input type="text" id="eventCodeInput" placeholder="Enter Event Code" value="2024mabri" />
  <button onclick="fetchMatches()">Load Matches</button>
</div>
<select id="matchSelect"></select>
<button onclick="clearCanvas()">Clear</button>
<canvas id="strategyCanvas" width="7680" height="3320"></canvas>

<script>
  const canvas = document.getElementById('strategyCanvas');
  const ctx = canvas.getContext('2d');
  const matchSelect = document.getElementById('matchSelect');
  let matches = [];

  function fetchMatches() {
    const eventCode = document.getElementById('eventCodeInput').value;
    const webhookEndpoint = `https://www.thebluealliance.com/api/v3/event/${eventCode}/matches/simple`;
    fetch(webhookEndpoint, {
      method: "GET",
      headers: {
        "X-TBA-Auth-Key": "J43Af3iggAp3XBvsVaGm5Hbc7IlK6XR8W8WxQhLDlPiQbv6BbW8LWDvVg8Zj9fCV",
      },
    })
    .then(response => response.json())
    .then(data => {
      matches = data;
      populateMatchSelect(data);
    })
    .catch(error => {
      console.error('Error fetching matches:', error);
      matches = [];
      populateMatchSelect([]);
    });
  }

  function populateMatchSelect(matches) {
    matchSelect.innerHTML = ''; // Clear previous options
    matches.forEach(match => {
      const option = document.createElement('option');
      option.value = match.key;
      option.textContent = `${match.comp_level.toUpperCase()} Match ${match.match_number}`;
      matchSelect.appendChild(option);
    });
  }

  function displayTeamsForSelectedMatch() {
    const selectedMatchKey = matchSelect.value;
    const match = matches.find(m => m.key === selectedMatchKey);
    if (!match) return;
    clearCanvas();
    // Example positions, adjust according to your canvas layout
    const bluePositions = [{x: 400, y: 700}, {x: 400, y: 1900}, {x: 400, y: 2500}];
    const redPositions = [{x: 6800, y: 2500}, {x: 6800, y: 1900}, {x: 6800, y: 700}];
    match.alliances.blue.team_keys.forEach((team, index) => {
      drawText(team.replace('frc', ''), bluePositions[index].x, bluePositions[index].y, 'blue');
    });
    match.alliances.red.team_keys.forEach((team, index) => {
      drawText(team.replace('frc', ''), redPositions[index].x, redPositions[index].y, 'red');
    });
  }

  function drawText(text, x, y, color) {
    ctx.fillStyle = color;
    ctx.font = 'bold 200px Arial'; // Increased font size and made it bold
    ctx.fillText(text, x, y);
  }

  function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  matchSelect.addEventListener('change', displayTeamsForSelectedMatch);
</script>
</body>
</html>
