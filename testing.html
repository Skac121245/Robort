<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robotics Match Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .hidden {
            display: none;
        }
        img {
            width: 100%;
            max-width: 600px;
            height: auto;
        }
        h1, h2, .container {
            text-align: center;
        }
        #field_image {
            background-image: url("images/crescendo_feild.png");
            background-size: contain;
            border: 1px solid #000;
            width: 1152px;
            height: 498px;
            display: flex;
        }
        #notesContainer .note-btn {
            display: inline;
            background-color: rgba(0, 200, 150, 0.5);
            border: none;
            color: white;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            position: absolute;
            opacity: 60%;
        }

        #position-btn-p1, #position-btn-p2, #position-btn-p3, #position-btn-p4 {
            position:relative;
            background-color: rgba(0, 123, 255, 0.5);
            /* Semi-transparent blue */
            border: none;
            color: white;
            /* padding: 10px; */
            cursor: pointer;
            transition: background-color 0.3s;
            height: 42px;
            width: 70px;
        }

        #position-btn-p5, #position-btn-p6, #position-btn-p7, #position-btn-p8 {
            position: absolute;
            background-color: rgba(255, 65, 65, 0.6);
            /* Semi-transparent blue */
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
    </style>
</head>
<body>
    <input type="file" id="uploadButton" accept=".json">
    <h1 id="teamDisplay" class="hidden"></h1>
    <h2 id="matchNumber" class="hidden"></h2>

    <div id="autoContainer" class="container hidden">
        <h3>Autonomous Phase</h3>
        <div id="field_image">
            <div id="notesContainer" style="position: relative; width: 100%; height: 100%;">
                <!-- Note buttons will be displayed by the script -->
                <button id="position-btn-p1" class="position-btn" style="top: 20%; left: 15%;">Position 1</button>
                <button id="position-btn-p2" class="position-btn" style="top: 35%; left: 17%;">Position 2</button>
                <button id="position-btn-p3" class="position-btn" style="top: 50%; left: 15%;">Position 3</button>
                <button id="position-btn-p4" class="position-btn" style="top: 70%; left: 15%;">Position 4</button>
        
                <button id="position-btn-p5" class="position-btn" style="top: 20%; left: 78%;">Position 5</button>
                <button id="position-btn-p6" class="position-btn" style="top: 35%; left: 75%;">Position 6</button>
                <button id="position-btn-p7" class="position-btn" style="top: 50%; left: 78%;">Position 7</button>
                <button id="position-btn-p8" class="position-btn" style="top: 70%; left: 78%;">Position 8</button>
            </div>

        </div>
        <ul id="autoActionsList"></ul>
    </div>

    <div id="teleopContainer" class="container hidden">
        <h3>Teleoperated Phase</h3>
        <div id="field_image"></div>
        <ul id="teleopActionsList"></ul>
    </div>

    <div id="endgameContainer" class="container hidden">
        <h3>Endgame Phase</h3>
        <p id="endgameAction"></p>
    </div>

    <script>
        document.getElementById('uploadButton').addEventListener('change', function(event) {
            const fileReader = new FileReader();
            fileReader.onload = function() {
                const data = JSON.parse(fileReader.result);
                document.getElementById('teamDisplay').textContent = "Team " + data.teamNumber;
                document.getElementById('matchNumber').textContent = "Match #" + data.matchNumber;
                document.getElementById('teamDisplay').classList.remove('hidden');
                document.getElementById('matchNumber').classList.remove('hidden');
                document.getElementById('uploadButton').classList.add('hidden');
    
                // Show only the relevant position button based on robot position from JSON
                const robotPosition = data.robotPosition.replace("Position ", "p"); // Converts "Position 2" to "p2"
                const positionButtons = document.querySelectorAll('.position-btn');
                positionButtons.forEach(button => button.style.display = 'none'); // Hide all position buttons initially
                const activePositionButton = document.getElementById(`position-btn-${robotPosition}`);
                if (activePositionButton) {
                    activePositionButton.style.display = 'block'; // Show only the relevant position button
                }
    
                // Populate note buttons based on autoActions, using the note number to determine colors
                const notesContainer = document.getElementById('notesContainer');
                data.autoActions.forEach(action => {
                    const noteIndex = parseInt(action.note.replace("Note ", "")); // Extracts the number from "Note X"
                    const noteButton = document.createElement('button');
                    noteButton.textContent = action.note;
                    noteButton.id = action.note;
                    noteButton.className = "note-btn";
                    noteButton.style.backgroundColor = getColorForButton(noteIndex); // Uses the note index for color
                    noteButton.style.top = '50%'; // Example position, adjust as needed
                    noteButton.style.left = '50%'; // Example position, adjust as needed
                    noteButton.style.transform = 'translate(-50%, -50%)'; // Center the button
                    notesContainer.appendChild(noteButton);
                });
                document.getElementById('autoContainer').classList.remove('hidden');
            };
            fileReader.readAsText(event.target.files[0]);
        });
    
        function getColorForButton(index) {
            const colors = ['#EF5350', '#FB8C00', '#FFEE58', '#4CAF50', '#1976D2', '#8E24AA', '#9E9E9E', '#616161', '#000000'];
            return colors[(index - 1) % colors.length]; // Uses index-1 to adjust for 0-based array access
        }
    </script>
</body>
</html>
